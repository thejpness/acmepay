---
const { tabs = [] } = Astro.props as { tabs: { id: string; label: string; content: string }[] };
---
<div class="glass rounded-2xl p-4" data-tabs>
  <div role="tablist" aria-orientation="horizontal" class="flex flex-wrap gap-2">
    {tabs.map((t, i) => (
      <button
        role="tab"
        id={`${t.id}-tab`}
        data-tab={t.id}
        aria-controls={t.id}
        aria-selected={i === 0}
        tabindex={i === 0 ? 0 : -1}
        class="rounded-full px-4 py-2 text-sm font-medium leading-none transition duration-150 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400/80 focus-visible:ring-offset-2 focus-visible:ring-offset-black/40 hover:bg-white/10 aria-selected:bg-white/15 aria-selected:text-white aria-selected:shadow-[0_0_0_1px_rgba(255,255,255,0.18)]"
      >
        {t.label}
      </button>
    ))}
  </div>
  <div class="mt-4 space-y-2">
    {tabs.map((t, i) => (
      <div
        role="tabpanel"
        id={t.id}
        aria-labelledby={`${t.id}-tab`}
        aria-hidden={i !== 0}
        tabindex={i === 0 ? 0 : -1}
        hidden={i !== 0}
        class="text-sm leading-relaxed text-white/80"
      >
        {t.content}
      </div>
    ))}
  </div>
</div>
<script is:inline>
  const root = document.currentScript?.previousElementSibling;

  if (root) {
    const tabs = [...root.querySelectorAll('[role="tab"]')].filter((el) => el instanceof HTMLElement);
    const panels = [...root.querySelectorAll('[role="tabpanel"]')].filter((el) => el instanceof HTMLElement);

    if (tabs.length === 0 || panels.length === 0) {
      return;
    }

    const setActive = (index) => {
      tabs.forEach((tab, i) => {
        const isActive = i === index;
        tab.setAttribute('aria-selected', String(isActive));
        tab.tabIndex = isActive ? 0 : -1;
        const panel = panels[i];
        if (panel) {
          panel.toggleAttribute('hidden', !isActive);
          panel.setAttribute('aria-hidden', String(!isActive));
          panel.tabIndex = isActive ? 0 : -1;
        }
      });
      requestAnimationFrame(() => {
        const activeTab = tabs[index];
        activeTab?.focus({ preventScroll: true });
      });
    };

    tabs.forEach((tab, index) => {
      tab.addEventListener('click', () => setActive(index));
      tab.addEventListener('keydown', (event) => {
        if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {
          event.preventDefault();
          const dir = event.key === 'ArrowRight' ? 1 : -1;
          const next = (index + dir + tabs.length) % tabs.length;
          setActive(next);
        } else if (event.key === 'Home') {
          event.preventDefault();
          setActive(0);
        } else if (event.key === 'End') {
          event.preventDefault();
          setActive(tabs.length - 1);
        }
      });
    });

    root.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        const activeIndex = tabs.findIndex((tab) => tab.getAttribute('aria-selected') === 'true');
        if (activeIndex !== -1) {
          setActive(activeIndex);
        }
      }
    });
  }
</script>
