---
/**
 * Posts to /api/subscribe with simple honeypot + aria-live feedback
 */
const id = 'nl';
---

<form class="glass p-4 rounded-2xl space-y-3" method="post" action="/api/subscribe" onsubmit="return false" client:load>
  <div class="sr-only" aria-hidden="true">
    <label for={`${id}-hp`}>Do not fill</label>
    <input id={`${id}-hp`} name="company" type="text" tabindex="-1" autocomplete="off" />
  </div>

  <label class="block text-sm" for={`${id}-email`}>Email</label>
  <input id={`${id}-email`} name="email" type="email" required
    class="w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2"
    placeholder="you@example.com" inputmode="email" />

  <button class="w-full rounded-xl px-4 py-2 text-sm font-medium text-white" style="background:var(--grad-accent)">
    Subscribe
  </button>

  <p id={`${id}-status`} class="text-sm" role="status" aria-live="polite"></p>
</form>

<script>
  const form = document.currentScript?.previousElementSibling as HTMLFormElement | null;
  const status = form?.querySelector('[role="status"]') as HTMLElement | null;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!form) return;
    const data = new FormData(form);
    status && (status.textContent = 'Submittingâ€¦');
    try {
      const res = await fetch('/api/subscribe', { method: 'POST', body: data });
      const j = await res.json();
      if (res.ok) {
        status && (status.textContent = 'Thanks! Please check your inbox.');
        form.reset();
      } else {
        status && (status.textContent = j?.message ?? 'Something went wrong.');
      }
    } catch {
      status && (status.textContent = 'Network error. Try again.');
    }
  });
</script>
